<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Financial Records &amp; History | Mothers' Union</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#17cf26",
                        "accent-gold": "#d4af37",
                        "background-light": "#f6f8f6",
                        "background-dark": "#112112",
                    },
                    fontFamily: {
                        "display": ["Lexend"]
                    },
                    borderRadius: {"DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px"},
                },
            },
        }
    </script>
<style>
    body {
        font-family: "Lexend", sans-serif;
    }
    .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
    }
    select {
        background-image: url(https://lh3.googleusercontent.com/aida-public/AB6AXuCKYIq_h_naKed8h9IOaJuuJbeh8Y81iNMCp-t-J4mzmfZKB94iCctxeJKTHPf2GpMrwmC_m0Lh6yOAVwBlEzyJ8jJ82fMsAs7JQDKI_D8FysHBuzKsJqgQbWQcjIPQsU98nFCQy1NyWCMzUyLXWmC_dibd4-QgPXZ1v0v2bC3WIpy7cajHzcQXtsIRcqkB7Mq35KTYk_WUaCNI4xc7lYL_Rv17DER96HezOXM7hJfUmAs00SjXm7Hi5PMNP0dpPl4X46BYIEpyDQ);
        background-repeat: no-repeat;
        background-position: right 0.75rem center;
        background-size: 1.5em 1.5em;
        appearance: none;
    }
    
    /* Toast notification */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        transform: translateX(120%);
        transition: transform 0.3s ease-out;
    }
    .toast.show {
        transform: translateX(0);
    }
    .toast.success {
        background-color: #10b981;
    }
    .toast.info {
        background-color: #3b82f6;
    }
    .toast.warning {
        background-color: #f59e0b;
    }
    .toast.error {
        background-color: #ef4444;
    }
    
    /* Loading spinner */
    .spinner {
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 3px solid #17cf26;
        width: 24px;
        height: 24px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    .modal.show {
        display: flex;
    }
    .modal-content {
        background: white;
        border-radius: 12px;
        padding: 24px;
        max-width: 500px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }
    .dark .modal-content {
        background: #1a2a1a;
        color: white;
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen text-[#111812] dark:text-white">
    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>
    
    <!-- Edit Transaction Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Edit Transaction</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-700">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <form id="editForm" class="space-y-4">
                <input type="hidden" id="editId">
                <div>
                    <label class="block text-sm font-medium mb-2">Date</label>
                    <input type="date" id="editDate" class="w-full p-2 border rounded" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Name / Source</label>
                    <input type="text" id="editSource" class="w-full p-2 border rounded" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Category</label>
                    <select id="editCategory" class="w-full p-2 border rounded" required>
                        <option value="Tithe">Tithes & Offerings</option>
                        <option value="Offering">Offering</option>
                        <option value="Project Fund">Community Event</option>
                        <option value="Membership Fee">Membership</option>
                        <option value="Donation">Grants</option>
                        <option value="Utilities">Utilities</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Money In</label>
                        <input type="number" id="editMoneyIn" class="w-full p-2 border rounded" placeholder="0" step="0.01">
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Money Out</label>
                        <input type="number" id="editMoneyOut" class="w-full p-2 border rounded" placeholder="0" step="0.01">
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="cancelEdit" class="px-4 py-2 border rounded hover:bg-gray-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-primary text-white rounded hover:bg-primary/90">
                        <span id="saveButtonText">Save Changes</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="text-center">
                <span class="material-symbols-outlined text-red-500 text-4xl mb-4">warning</span>
                <h3 class="text-xl font-bold mb-2">Delete Transaction</h3>
                <p class="text-gray-600 dark:text-gray-300 mb-6">Are you sure you want to delete this transaction? This action cannot be undone.</p>
                <div class="flex justify-center gap-4">
                    <button id="cancelDelete" class="px-6 py-2 border rounded hover:bg-gray-50">Cancel</button>
                    <button id="confirmDelete" class="px-6 py-2 bg-red-500 text-white rounded hover:bg-red-600">Delete</button>
                </div>
            </div>
        </div>
    </div>

<!-- Top Navigation Bar -->
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-[#dce5dc] dark:border-[#2a3a2a] bg-white dark:bg-[#1a2a1a] px-10 py-3 sticky top-0 z-50">
<div class="flex items-center gap-4 text-[#111812] dark:text-white">
<div class="size-8 text-primary">
<span class="material-symbols-outlined text-4xl">account_balance</span>
</div>
<h2 class="text-[#111812] dark:text-white text-xl font-bold leading-tight tracking-[-0.015em]">Mothers' Union Finance</h2>
</div>
<div class="flex flex-1 justify-end gap-6 items-center">
<nav class="flex items-center gap-8 mr-4">
<a class="text-[#111812] dark:text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="dashboard.html">Dashboard</a>
<a class="text-[#111812] dark:text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="transactions-new.html">Record</a>

<a class="text-primary text-sm font-bold leading-normal border-b-2 border-primary pb-1" href="Transactions.html"> Financial Records</a>

<a class="text-[#111812] dark:text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="members.html">Members</a>
<a class="text-[#111812] dark:text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="reports.html">Reports</a>
<a class="text-[#111812] dark:text-white text-sm font-medium leading-normal hover:text-primary transition-colors" href="setting.html">Settings</a>

</nav>
<div class="flex gap-2">
<button id="exportBtn" class="flex min-w-[84px] cursor-pointer items-center justify-center rounded-lg h-10 px-4 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-opacity-90 transition-all">
<span class="material-symbols-outlined mr-2 text-sm">picture_as_pdf</span>
<span class="truncate">Export</span>
</button>
</div>
<div class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10 border-2 border-primary/20" data-alt="Portrait of a church official" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCXhkxFzOC7Fsx5ywMMY61lJP1qoGcHThMmhS_K2OhiRPPj939p-Lotjum-CgjuChTAPJ1lRjSxT_fyQO168u2hLpyBRP42I07By-z25DuxW7YmCjTnPe2Sn2pFFlkRuMc5CH1C6IVkvY_2bobgOeplkt4Yc5iQNB4vlfA4N1e0igeEqpsXf9gYzz4EeX9sXp62INn3bbc14kPmvBvPPMFC1EwCcqj92F0_4aUw6Cpb_E4YoAhLa0OeA9i7kkaRAKRPj12rWZb8_Q");'></div>
</div>
</header>
<main class="max-w-[1200px] mx-auto py-8 px-6">
<!-- Page Heading -->
<div class="flex flex-wrap justify-between items-end gap-3 pb-8">
<div class="flex flex-col gap-2">
<h1 class="text-[#111812] dark:text-white text-4xl font-black leading-tight tracking-[-0.033em]">Financial Records &amp; History</h1>
<p class="text-[#638866] dark:text-[#a3c3a6] text-lg font-normal leading-normal">Transparency and accountability for our Mothers' Union community</p>
</div>
<a href="index.html" class="flex min-w-[160px] cursor-pointer items-center justify-center rounded-xl h-14 px-6 bg-[#111812] dark:bg-primary text-white text-base font-bold leading-normal tracking-[0.015em] shadow-lg hover:scale-[1.02] transition-transform">
<span class="material-symbols-outlined mr-2">add_circle</span>
<span class="truncate">Add New Record</span>
</a>
</div>
<!-- Summary Cards Section -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
<div class="bg-white dark:bg-[#1a2a1a] p-8 rounded-xl border border-[#dce5dc] dark:border-[#2a3a2a] shadow-sm flex items-center justify-between">
<div>
<p class="text-[#638866] dark:text-[#a3c3a6] text-sm font-bold uppercase tracking-wider mb-1">Total Monthly Income</p>
<p class="text-primary text-5xl font-black" id="totalIncome">KSH 0</p>
</div>
<div class="bg-primary/10 p-4 rounded-full">
<span class="material-symbols-outlined text-primary text-4xl">trending_up</span>
</div>
</div>
<div class="bg-white dark:bg-[#1a2a1a] p-8 rounded-xl border border-[#dce5dc] dark:border-[#2a3a2a] shadow-sm flex items-center justify-between">
<div>
<p class="text-[#638866] dark:text-[#a3c3a6] text-sm font-bold uppercase tracking-wider mb-1">Total Monthly Expenses</p>
<p class="text-accent-gold text-5xl font-black" id="totalExpenses">KSH 0</p>
</div>
<div class="bg-accent-gold/10 p-4 rounded-full">
<span class="material-symbols-outlined text-accent-gold text-4xl">trending_down</span>
</div>
</div>
</div>
<!-- Filters and Search Bar -->
<div class="bg-white dark:bg-[#1a2a1a] p-6 rounded-xl border border-[#dce5dc] dark:border-[#2a3a2a] shadow-sm mb-6">
<div class="flex flex-wrap items-end gap-6">
<!-- Search Bar -->
<div class="flex-1 min-w-[300px]">
<p class="text-[#111812] dark:text-white text-base font-medium leading-normal pb-2">Search Records</p>
<div class="relative">
<span class="material-symbols-outlined absolute left-4 top-1/2 -translate-y-1/2 text-[#638866]">search</span>
<input id="searchInput" class="flex w-full rounded-lg text-[#111812] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#dce5dc] dark:border-[#2a3a2a] bg-white dark:bg-[#112112] h-14 pl-12 pr-4 text-base font-normal" placeholder="Search by name, source, or category..." type="text"/>
</div>
</div>
<!-- Date Range Select -->
<label class="flex flex-col min-w-[200px]">
<p class="text-[#111812] dark:text-white text-base font-medium leading-normal pb-2">Date Range</p>
<select id="dateRange" class="form-input flex w-full rounded-lg text-[#111812] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#dce5dc] dark:border-[#2a3a2a] bg-white dark:bg-[#112112] h-14 p-[15px] text-base font-normal">
<option value="current-month">Current Month</option>
<option value="last-month">Last Month</option>
<option value="last-3">Last 3 Months</option>
<option value="last-6">Last 6 Months</option>
<option value="current-year">Current Year</option>
<option value="all">All Time</option>
</select>
</label>
<!-- Transaction Type Select -->
<label class="flex flex-col min-w-[200px]">
<p class="text-[#111812] dark:text-white text-base font-medium leading-normal pb-2">Transaction Type</p>
<select id="transactionType" class="form-input flex w-full rounded-lg text-[#111812] dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#dce5dc] dark:border-[#2a3a2a] bg-white dark:bg-[#112112] h-14 p-[15px] text-base font-normal">
<option value="all">All Transactions</option>
<option value="income">Income Only</option>
<option value="expense">Expenses Only</option>
</select>
</label>
</div>
</div>
<!-- Tabs -->
<div class="mb-4">
<div class="flex border-b border-[#dce5dc] dark:border-[#2a3a2a] gap-8 px-4">
<button id="allTab" class="flex flex-col items-center justify-center border-b-[3px] border-b-primary text-primary pb-3 pt-4 font-bold">
<span id="allCount">All Transactions (0)</span>
</button>
<button id="incomeTab" class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#638866] hover:text-[#111812] dark:hover:text-white pb-3 pt-4 font-bold transition-all">
<span id="incomeCount">Income (0)</span>
</button>
<button id="expenseTab" class="flex flex-col items-center justify-center border-b-[3px] border-b-transparent text-[#638866] hover:text-[#111812] dark:hover:text-white pb-3 pt-4 font-bold transition-all">
<span id="expenseCount">Expenses (0)</span>
</button>
</div>
</div>
<!-- Records Table -->
<div class="bg-white dark:bg-[#1a2a1a] rounded-xl border border-[#dce5dc] dark:border-[#2a3a2a] overflow-hidden shadow-sm">
<div id="loadingTable" class="p-12 text-center hidden">
<div class="inline-block spinner mb-4"></div>
<p class="text-[#638866]">Loading transactions...</p>
</div>
<table class="w-full text-left border-collapse" id="transactionsTable">
<thead>
<tr class="bg-[#f0f4f1] dark:bg-[#112112] text-[#111812] dark:text-white">
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider">Date</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider">Name / Source</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider">Category</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider text-right">Money In</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider text-right">Money Out</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider">Recorded By</th>
<th class="px-6 py-4 font-bold text-sm uppercase tracking-wider text-center">Actions</th>
</tr>
</thead>
<tbody id="transactionsBody" class="divide-y divide-[#dce5dc] dark:divide-[#2a3a2a]">
<!-- Transactions will be loaded here -->
</tbody>
</table>
<!-- Empty State -->
<div id="emptyState" class="hidden p-12 text-center">
<span class="material-symbols-outlined text-5xl text-gray-400 mb-4">receipt_long</span>
<p class="text-xl font-bold text-gray-600 dark:text-gray-300 mb-2">No transactions found</p>
<p class="text-gray-500 dark:text-gray-400">Try adjusting your filters or add a new transaction.</p>
</div>
<!-- Pagination -->
<div class="p-6 border-t border-[#dce5dc] dark:border-[#2a3a2a] flex items-center justify-between bg-white dark:bg-[#1a2a1a]" id="paginationContainer">
<p class="text-sm text-[#638866] dark:text-[#a3c3a6]" id="paginationText">Showing 0 entries</p>
<div class="flex gap-2" id="paginationButtons">
<!-- Pagination buttons will be generated here -->
</div>
</div>
</div>
</main>
<!-- Simple Footer -->
<footer class="mt-12 py-8 border-t border-[#dce5dc] dark:border-[#2a3a2a] bg-white dark:bg-[#1a2a1a]">
<div class="max-w-[1200px] mx-auto px-6 text-center">
<p class="text-[#638866] text-sm">Â© <span id="currentYear">2026</span> Mothers' Union Anglican Diocese. All financial data is encrypted and secure.</p>
</div>
</footer>

<script>
// Toast notification function
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `
        <div class="flex items-center gap-2">
            <span class="material-symbols-outlined text-sm">
                ${type === 'success' ? 'check_circle' : 
                  type === 'warning' ? 'warning' : 
                  type === 'error' ? 'error' : 'info'}
            </span>
            <span>${message}</span>
        </div>
    `;
    toastContainer.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 10);
    
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 4000);
}

// Format currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-KE', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(amount);
}

// Format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', {
        day: '2-digit',
        month: 'short',
        year: 'numeric'
    }).replace(/ /g, ' ');
}

// Get category badge HTML
function getCategoryBadge(category) {
    const categoryMap = {
        'Tithe': { class: 'bg-primary/10 text-primary', text: 'Tithes & Offerings' },
        'Offering': { class: 'bg-primary/10 text-primary', text: 'Offering' },
        'Project Fund': { class: 'bg-primary/10 text-primary', text: 'Community Event' },
        'Membership Fee': { class: 'bg-primary/10 text-primary', text: 'Membership' },
        'Donation': { class: 'bg-primary/10 text-primary', text: 'Grants' },
        'Utilities': { class: 'bg-accent-gold/10 text-accent-gold', text: 'Utilities' },
        'Community Event': { class: 'bg-accent-gold/10 text-accent-gold', text: 'Community Event' },
    };
    
    const badge = categoryMap[category] || { class: 'bg-gray-100 text-gray-800', text: category };
    return `<span class="px-3 py-1 ${badge.class} text-xs font-bold rounded-full uppercase">${badge.text}</span>`;
}

// Load transactions from localStorage
function loadTransactions() {
    return JSON.parse(localStorage.getItem('mothersUnionTransactions') || '[]');
}

// Save transactions to localStorage
function saveTransactions(transactions) {
    localStorage.setItem('mothersUnionTransactions', JSON.stringify(transactions));
}

// Filter transactions based on current filters
function filterTransactions(transactions) {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const dateRange = document.getElementById('dateRange').value;
    const transactionType = document.getElementById('transactionType').value;
    const activeTab = document.querySelector('[class*="border-b-primary"]')?.id?.replace('Tab', '') || 'all';
    
    const now = new Date();
    let filtered = transactions;
    
    // Filter by date range
    if (dateRange !== 'all') {
        filtered = filtered.filter(tx => {
            const txDate = new Date(tx.date);
            
            switch(dateRange) {
                case 'current-month':
                    return txDate.getMonth() === now.getMonth() && txDate.getFullYear() === now.getFullYear();
                case 'last-month':
                    const lastMonth = new Date(now.getFullYear(), now.getMonth() - 1);
                    return txDate.getMonth() === lastMonth.getMonth() && txDate.getFullYear() === lastMonth.getFullYear();
                case 'last-3':
                    const threeMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 3);
                    return txDate >= threeMonthsAgo;
                case 'last-6':
                    const sixMonthsAgo = new Date(now.getFullYear(), now.getMonth() - 6);
                    return txDate >= sixMonthsAgo;
                case 'current-year':
                    return txDate.getFullYear() === now.getFullYear();
                default:
                    return true;
            }
        });
    }
    
    // Filter by transaction type
    if (transactionType !== 'all') {
        filtered = filtered.filter(tx => {
            if (transactionType === 'income') return tx.type === 'money_in';
            if (transactionType === 'expense') return tx.type === 'money_out';
            return true;
        });
    }
    
    // Filter by search term
    if (searchTerm) {
        filtered = filtered.filter(tx => 
            tx.source.toLowerCase().includes(searchTerm) ||
            tx.category.toLowerCase().includes(searchTerm) ||
            (tx.description && tx.description.toLowerCase().includes(searchTerm))
        );
    }
    
    // Filter by active tab
    if (activeTab === 'income') {
        filtered = filtered.filter(tx => tx.type === 'money_in');
    } else if (activeTab === 'expense') {
        filtered = filtered.filter(tx => tx.type === 'money_out');
    }
    
    return filtered;
}

// Update summary statistics
function updateStatistics(transactions) {
    const filtered = filterTransactions(transactions);
    const currentMonth = new Date().getMonth();
    const currentYear = new Date().getFullYear();
    
    let monthlyIncome = 0;
    let monthlyExpenses = 0;
    
    filtered.forEach(tx => {
        const txDate = new Date(tx.date);
        if (txDate.getMonth() === currentMonth && txDate.getFullYear() === currentYear) {
            if (tx.type === 'money_in') {
                monthlyIncome += parseFloat(tx.amount);
            } else {
                monthlyExpenses += parseFloat(tx.amount);
            }
        }
    });
    
    document.getElementById('totalIncome').textContent = `KSH ${formatCurrency(monthlyIncome)}`;
    document.getElementById('totalExpenses').textContent = `KSH ${formatCurrency(monthlyExpenses)}`;
}

// Update transaction counts
function updateTransactionCounts(transactions) {
    const filtered = filterTransactions(transactions);
    const incomeCount = filtered.filter(tx => tx.type === 'money_in').length;
    const expenseCount = filtered.filter(tx => tx.type === 'money_out').length;
    
    document.getElementById('allCount').textContent = `All Transactions (${filtered.length})`;
    document.getElementById('incomeCount').textContent = `Income (${incomeCount})`;
    document.getElementById('expenseCount').textContent = `Expenses (${expenseCount})`;
}

// Render transactions table
function renderTransactions(transactions) {
    const filtered = filterTransactions(transactions);
    const tbody = document.getElementById('transactionsBody');
    const emptyState = document.getElementById('emptyState');
    const table = document.getElementById('transactionsTable');
    const loadingTable = document.getElementById('loadingTable');
    
    // Show loading briefly
    loadingTable.classList.remove('hidden');
    table.classList.add('hidden');
    emptyState.classList.add('hidden');
    
    setTimeout(() => {
        loadingTable.classList.add('hidden');
        
        if (filtered.length === 0) {
            emptyState.classList.remove('hidden');
            table.classList.add('hidden');
            document.getElementById('paginationContainer').classList.add('hidden');
            return;
        }
        
        table.classList.remove('hidden');
        emptyState.classList.add('hidden');
        document.getElementById('paginationContainer').classList.remove('hidden');
        
        // Sort by date (newest first)
        filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Pagination
        const currentPage = 1;
        const itemsPerPage = 10;
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const paginated = filtered.slice(startIndex, endIndex);
        const totalPages = Math.ceil(filtered.length / itemsPerPage);
        
        // Render table rows
        tbody.innerHTML = '';
        paginated.forEach(tx => {
            const row = document.createElement('tr');
            row.className = 'hover:bg-primary/5 transition-colors';
            row.innerHTML = `
                <td class="px-6 py-5 text-base font-medium">${formatDate(tx.date)}</td>
                <td class="px-6 py-5 text-base font-bold">${tx.source}</td>
                <td class="px-6 py-5">${getCategoryBadge(tx.category)}</td>
                <td class="px-6 py-5 text-right font-black ${tx.type === 'money_in' ? 'text-primary' : 'text-gray-400'}">
                    ${tx.type === 'money_in' ? formatCurrency(parseFloat(tx.amount)) : '-'}
                </td>
                <td class="px-6 py-5 text-right font-black ${tx.type === 'money_out' ? 'text-accent-gold' : 'text-gray-400'}">
                    ${tx.type === 'money_out' ? formatCurrency(parseFloat(tx.amount)) : '-'}
                </td>
                <td class="px-6 py-5 text-base">${tx.recordedBy || 'System'}</td>
                <td class="px-6 py-5 text-center">
                    <button class="edit-btn text-[#638866] hover:text-primary mr-2" data-id="${tx.id}">
                        <span class="material-symbols-outlined">edit_square</span>
                    </button>
                    <button class="delete-btn text-[#638866] hover:text-red-500" data-id="${tx.id}">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                </td>
            `;
            tbody.appendChild(row);
        });
        
        // Update pagination
        updatePagination(filtered.length, currentPage, totalPages);
        
        // Add event listeners to edit and delete buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
            btn.addEventListener('click', () => editTransaction(btn.dataset.id));
        });
        
        document.querySelectorAll('.delete-btn').forEach(btn => {
            btn.addEventListener('click', () => showDeleteModal(btn.dataset.id));
        });
        
        // Update counts and statistics
        updateTransactionCounts(transactions);
        updateStatistics(transactions);
    }, 500);
}

// Update pagination
function updatePagination(totalItems, currentPage, totalPages) {
    const paginationText = document.getElementById('paginationText');
    const paginationButtons = document.getElementById('paginationButtons');
    
    const startItem = (currentPage - 1) * 10 + 1;
    const endItem = Math.min(currentPage * 10, totalItems);
    
    paginationText.textContent = `Showing ${startItem} to ${endItem} of ${totalItems} entries`;
    
    let buttonsHTML = '';
    
    // Previous button
    buttonsHTML += `
        <button class="pagination-btn prev px-4 py-2 border border-[#dce5dc] dark:border-[#2a3a2a] rounded-lg text-sm font-bold hover:bg-[#f0f4f1] dark:hover:bg-[#112112] transition-colors ${currentPage === 1 ? 'opacity-50 cursor-not-allowed' : ''}" data-page="${currentPage - 1}" ${currentPage === 1 ? 'disabled' : ''}>
            Previous
        </button>
    `;
    
    // Page buttons
    for (let i = 1; i <= totalPages; i++) {
        if (i <= 3 || i === totalPages || Math.abs(i - currentPage) <= 1) {
            buttonsHTML += `
                <button class="pagination-btn px-4 py-2 ${i === currentPage ? 'bg-primary text-white' : 'border border-[#dce5dc] dark:border-[#2a3a2a]'} rounded-lg text-sm font-bold hover:bg-[#f0f4f1] dark:hover:bg-[#112112] transition-colors" data-page="${i}">
                    ${i}
                </button>
            `;
        } else if (i === 4 && totalPages > 5) {
            buttonsHTML += `<span class="px-2 py-2">...</span>`;
        }
    }
    
    // Next button
    buttonsHTML += `
        <button class="pagination-btn next px-4 py-2 border border-[#dce5dc] dark:border-[#2a3a2a] rounded-lg text-sm font-bold hover:bg-[#f0f4f1] dark:hover:bg-[#112112] transition-colors ${currentPage === totalPages ? 'opacity-50 cursor-not-allowed' : ''}" data-page="${currentPage + 1}" ${currentPage === totalPages ? 'disabled' : ''}>
            Next
        </button>
    `;
    
    paginationButtons.innerHTML = buttonsHTML;
    
    // Add event listeners to pagination buttons
    document.querySelectorAll('.pagination-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            if (!btn.disabled) {
                // In a real app, you would update currentPage and re-render
                showToast('Pagination would load page ' + btn.dataset.page, 'info');
            }
        });
    });
}

// Edit transaction
function editTransaction(id) {
    const transactions = loadTransactions();
    const transaction = transactions.find(tx => tx.id == id);
    
    if (!transaction) {
        showToast('Transaction not found', 'error');
        return;
    }
    
    // Populate edit form
    document.getElementById('editId').value = transaction.id;
    document.getElementById('editDate').value = transaction.date;
    document.getElementById('editSource').value = transaction.source;
    document.getElementById('editCategory').value = transaction.category;
    
    if (transaction.type === 'money_in') {
        document.getElementById('editMoneyIn').value = transaction.amount;
        document.getElementById('editMoneyOut').value = '';
    } else {
        document.getElementById('editMoneyIn').value = '';
        document.getElementById('editMoneyOut').value = transaction.amount;
    }
    
    // Show modal
    document.getElementById('editModal').classList.add('show');
}

// Delete transaction
function showDeleteModal(id) {
    document.getElementById('deleteModal').classList.add('show');
    
    // Store the ID to delete
    document.getElementById('confirmDelete').dataset.id = id;
}

function deleteTransaction(id) {
    let transactions = loadTransactions();
    const originalLength = transactions.length;
    transactions = transactions.filter(tx => tx.id != id);
    
    if (transactions.length < originalLength) {
        saveTransactions(transactions);
        showToast('Transaction deleted successfully', 'success');
        refreshData();
    } else {
        showToast('Transaction not found', 'error');
    }
}

// Refresh all data
function refreshData() {
    const transactions = loadTransactions();
    renderTransactions(transactions);
}

// Export to PDF/CSV
function exportData() {
    showToast('Preparing export...', 'info');
    
    // Simulate export process
    setTimeout(() => {
        const transactions = loadTransactions();
        const filtered = filterTransactions(transactions);
        
        if (filtered.length === 0) {
            showToast('No data to export', 'warning');
            return;
        }
        
        // Create CSV content
        let csvContent = "Date,Source,Category,Amount,Type\n";
        filtered.forEach(tx => {
            csvContent += `"${formatDate(tx.date)}","${tx.source}","${tx.category}","${tx.amount}","${tx.type === 'money_in' ? 'Income' : 'Expense'}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mothers-union-transactions-${new Date().toISOString().split('T')[0]}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
        
        showToast(`Exported ${filtered.length} transactions`, 'success');
    }, 1000);
}

// Initialize everything when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Set current year in footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    
    // Initial data load
    refreshData();
    
    // Event Listeners
    
    // Search input with debounce
    let searchTimeout;
    document.getElementById('searchInput').addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => refreshData(), 300);
    });
    
    // Filter select changes
    document.getElementById('dateRange').addEventListener('change', refreshData);
    document.getElementById('transactionType').addEventListener('change', refreshData);
    
    // Tab clicks
    document.getElementById('allTab').addEventListener('click', function() {
        document.querySelectorAll('[class*="border-b-primary"]').forEach(el => {
            el.classList.remove('border-b-primary', 'text-primary');
            el.classList.add('border-b-transparent', 'text-[#638866]');
        });
        this.classList.remove('border-b-transparent', 'text-[#638866]');
        this.classList.add('border-b-primary', 'text-primary');
        refreshData();
    });
    
    document.getElementById('incomeTab').addEventListener('click', function() {
        document.querySelectorAll('[class*="border-b-primary"]').forEach(el => {
            el.classList.remove('border-b-primary', 'text-primary');
            el.classList.add('border-b-transparent', 'text-[#638866]');
        });
        this.classList.remove('border-b-transparent', 'text-[#638866]');
        this.classList.add('border-b-primary', 'text-primary');
        refreshData();
    });
    
    document.getElementById('expenseTab').addEventListener('click', function() {
        document.querySelectorAll('[class*="border-b-primary"]').forEach(el => {
            el.classList.remove('border-b-primary', 'text-primary');
            el.classList.add('border-b-transparent', 'text-[#638866]');
        });
        this.classList.remove('border-b-transparent', 'text-[#638866]');
        this.classList.add('border-b-primary', 'text-primary');
        refreshData();
    });
    
    // Export button
    document.getElementById('exportBtn').addEventListener('click', exportData);
    
    // Modal close buttons
    document.getElementById('closeModal').addEventListener('click', function() {
        document.getElementById('editModal').classList.remove('show');
    });
    
    document.getElementById('cancelEdit').addEventListener('click', function() {
        document.getElementById('editModal').classList.remove('show');
    });
    
    document.getElementById('cancelDelete').addEventListener('click', function() {
        document.getElementById('deleteModal').classList.remove('show');
    });
    
    // Confirm delete
    document.getElementById('confirmDelete').addEventListener('click', function() {
        const id = this.dataset.id;
        document.getElementById('deleteModal').classList.remove('show');
        deleteTransaction(id);
    });
    
    // Edit form submission
    document.getElementById('editForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const id = parseInt(document.getElementById('editId').value);
        const date = document.getElementById('editDate').value;
        const source = document.getElementById('editSource').value;
        const category = document.getElementById('editCategory').value;
        const moneyIn = document.getElementById('editMoneyIn').value;
        const moneyOut = document.getElementById('editMoneyOut').value;
        
        let transactions = loadTransactions();
        const index = transactions.findIndex(tx => tx.id === id);
        
        if (index === -1) {
            showToast('Transaction not found', 'error');
            return;
        }
        
        // Update transaction
        transactions[index] = {
            ...transactions[index],
            date,
            source,
            category,
            amount: moneyIn || moneyOut,
            type: moneyIn ? 'money_in' : 'money_out',
            updatedAt: new Date().toISOString()
        };
        
        saveTransactions(transactions);
        document.getElementById('editModal').classList.remove('show');
        showToast('Transaction updated successfully', 'success');
        refreshData();
    });
    
    // Close modals when clicking outside
    window.addEventListener('click', function(e) {
        const editModal = document.getElementById('editModal');
        const deleteModal = document.getElementById('deleteModal');
        
        if (e.target === editModal) {
            editModal.classList.remove('show');
        }
        if (e.target === deleteModal) {
            deleteModal.classList.remove('show');
        }
    });
    
    // Auto-refresh data every 30 seconds
    setInterval(refreshData, 30000);
    
    // Show welcome message
    setTimeout(() => {
        const transactions = loadTransactions();
        if (transactions.length > 0) {
            showToast(`Loaded ${transactions.length} transactions`, 'info');
        }
    }, 1000);
    
    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'e') {
            e.preventDefault();
            showToast('Press Ctrl+F to search, Ctrl+R to refresh', 'info');
        }
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('searchInput').focus();
        }
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            refreshData();
            showToast('Data refreshed', 'success');
        }
    });
    
    // Display keyboard shortcuts help on first visit
    if (!localStorage.getItem('recordsHelpShown')) {
        setTimeout(() => {
            showToast('Tip: Use Ctrl+F to search, Ctrl+R to refresh data', 'info');
            localStorage.setItem('recordsHelpShown', 'true');
        }, 2000);
    }
});
</script>
</body>
</html>